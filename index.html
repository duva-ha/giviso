<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartTeacher - Giviso Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: sans-serif; background-color: #fcfdfe; }
        .page-content { display: none; padding-bottom: 120px; }
        .page-content.active { display: block; }
        .glass-card { background: white; border: 1px solid #f1f5f9; border-radius: 2.5rem; }
        .file-item { display: flex; align-items: center; justify-content: space-between; background: #f8fafc; padding: 12px; border-radius: 16px; margin-top: 8px; border: 1px solid #f1f5f9; }
    </style>
</head>
<body class="text-slate-900">
    <main class="max-w-6xl mx-auto pt-20 px-6">
        <div id="home" class="page-content active space-y-10 text-center">
            <h1 class="text-2xl font-bold text-blue-600">HỆ THỐNG GIVISO</h1>
            <div id="file-list" class="max-w-md mx-auto space-y-2"></div>
        </div>
    </main>

    <button onclick="document.getElementById('file-in').click()" class="fixed bottom-10 left-1/2 -translate-x-1/2 w-16 h-16 bg-blue-600 text-white rounded-full shadow-2xl text-3xl font-bold">+</button>
    <input type="file" id="file-in" class="hidden">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBGNOpqBT1Zm48QiysdKgG-y_rHWDlz28g",
            authDomain: "giviso.firebaseapp.com",
            projectId: "giviso",
            storageBucket: "giviso.firebasestorage.app",
            messagingSenderId: "738030109462",
            appId: "1:738030109462:web:5352db48482baf666a4637",
            measurementId: "G-TVTYZC5X6Z"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        document.getElementById('file-in').onchange = async (e) => {
            const file = e.target.files[0]; if(!file) return;
            try {
                const path = `uploads/${Date.now()}_${file.name}`;
                const sRef = ref(storage, path);
                await uploadBytes(sRef, file);
                const url = await getDownloadURL(sRef);
                await setDoc(doc(db, "data", "files"), { list: arrayUnion({ name: file.name, url: url, path: path }) }, { merge: true });
                load();
            } catch(err) { alert("Lỗi! Kiểm tra Rules và CORS."); }
        };

        async function load() {
            const snap = await getDoc(doc(db, "data", "files"));
            const div = document.getElementById('file-list'); div.innerHTML = '';
            if(snap.exists() && snap.data().list) {
                snap.data().list.reverse().forEach(f => {
                    div.innerHTML += `<div class="file-item"><span>${f.name}</span><button onclick="window.open('${f.url}')" class="text-blue-500 font-bold">Xem</button></div>`;
                });
            }
        }
        load();
    </script>
</body>
</html>
